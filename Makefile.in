# $Id: Makefile.in,v 1.17 2000/08/20 14:59:54 leonard Exp $

PYTHON=		@PYTHON@
LIBDEST=	@LIBDEST@
INSTALL=	$(LIBDEST)/config/install-sh -c
INSTALL_DATA=	$(INSTALL) -m 644
INSTALL_DIR=	mkdir -p
srcdir=		@srcdir@
srcdir_abs=	@srcdir_abs@

MAKEVARS=	srcdir=$(srcdir_abs)/Modules VPATH=$(srcdir_abs)/Modules

all:	 build

build:   _ldapmodule-build 
install: _ldapmodule-install 
filelist: _empty-filelist _ldapmodule-filelist

_ldapmodule-build:
	cd Modules && $(MAKE) $(MAKEVARS)

_ldapmodule-install:
	$(INSTALL_DIR) $(DESTDIR)$(LIBDEST)/site-packages/python-ldap
	cd Modules && $(MAKE) $(MAKEVARS) install \
				prefix='${DESTDIR}$${installdir}'
	$(INSTALL_DIR) $(DESTDIR)$(LIBDEST)/site-packages/python-ldap
	$(INSTALL_DATA) $(srcdir)/Misc/ldap.pth \
		$(DESTDIR)$(LIBDEST)/site-packages/ldap.pth
	for f in $(srcdir)/Lib/*.py; do \
	   $(INSTALL_DATA) $$f $(DESTDIR)$(LIBDEST)/site-packages/python-ldap/;\
        done
	$(PYTHON) $(LIBDEST)/compileall.py \
		$(DESTDIR)$(LIBDEST)/site-packages/python-ldap
	$(PYTHON) -O $(LIBDEST)/compileall.py \
		$(DESTDIR)$(LIBDEST)/site-packages/python-ldap

_ldapmodule-filelist:
	echo "$(LIBDEST)/site-packages/ldap.pth" >> filelist
	echo "$(LIBDEST)/site-packages/_ldapmodule.so" >> filelist
	for ff in $(srcdir)/Lib/*.py; do \
		f=`basename $$ff .py`; \
		echo "$(LIBDEST)/site-packages/python-ldap/$$f.py"; \
		echo "$(LIBDEST)/site-packages/python-ldap/$$f.pyc"; \
		echo "$(LIBDEST)/site-packages/python-ldap/$$f.pyo"; \
	done >> filelist

_empty-filelist:	
	cp /dev/null filelist

distclean:
	cd Modules && $(MAKE) $(MAKEVARS) distclean
	rm -f Modules/Setup Modules/config.h config.* Makefile
