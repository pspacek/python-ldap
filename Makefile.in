# $Id: Makefile.in,v 1.13 2000/08/15 01:50:03 leonard Exp $

PYTHON=		@PYTHON@
LIBDEST=	@LIBDEST@
INSTALL=	$(LIBDEST)/config/install-sh
INSTALL_DATA=	$(INSTALL) -m 644
INSTALL_DIR=	mkdir -p
srcdir=		@srcdir@
srcdir_ABS=	`cd $(srcdir) && pwd`

MAKEVARS=	srcdir=$(srcdir_ABS)/Modules VPATH=$(srcdir_ABS)/Modules

all:	 build

build:   _ldapmodule-build 
install: _ldapmodule-install 
filelist: _empty-filelist _ldapmodule-filelist

_ldapmodule-build:
	cd Modules && $(MAKE) $(MAKEVARS)

_ldapmodule-install:
	$(INSTALL_DIR) $(DESTDIR)$(LIBDEST)/site-packages/python-ldap
	cd Modules && $(MAKE) $(MAKEVARS) install \
				prefix='${DESTDIR}$${installdir}'
	$(INSTALL_DIR) $(DESTDIR)$(LIBDEST)/site-packages/python-ldap
	$(INSTALL_DATA) $(srcdir)/Misc/ldap.pth \
		$(DESTDIR)$(LIBDEST)/site-packages/ldap.pth
	for f in $(srcdir)/Lib/*.py; do \
	   $(INSTALL_DATA) $$f $(DESTDIR)$(LIBDEST)/site-packages/python-ldap/;\
        done
	$(PYTHON) $(LIBDEST)/compileall.py \
		$(DESTDIR)$(LIBDEST)/site-packages/python-ldap
	$(PYTHON) -O $(LIBDEST)/compileall.py \
		$(DESTDIR)$(LIBDEST)/site-packages/python-ldap

_ldapmodule-filelist:
	echo "$(LIBDEST)/site-packages/ldap.pth" >> filelist
	echo "$(LIBDEST)/site-packages/python-ldap/_ldapmodule.so" >> filelist
	for ff in $(srcdir)/Lib/*.py; do \
		f=`basename $$f .py`; \
		echo "$(LIBDEST)/site-packages/python-ldap/$$f.py"; \
		echo "$(LIBDEST)/site-packages/python-ldap/$$f.pyc"; \
		echo "$(LIBDEST)/site-packages/python-ldap/$$f.pyo"; \
	done >> filelist

_empty-filelist:	
	cp /dev/null filelist
